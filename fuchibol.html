<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Penales 2D</title>
</head>
<body>

    <div class="timer">Tiempo: <span id="time">120</span></div>

    <div class="scoreboard">
        <div>Jugador 1: <span id="score-1">0</span></div>
    </div>

    <div id="game-container">
        <div id="goal-left" class="goal"></div>
        <div id="goal-right" class="goal"></div>
        <div id="player-left" class="player"><img src="img/cabeza1.png" style="width: 80px; height: 80px;"></div>
        <div id="player-right" class="player"><img src="img/cabeza2.png" style="width: 80px; height: 80px;"></div>
        <!--<div id="player-left" class="player">⚫</div>-->
        <!--<div id="player-right" class="player">⚪</div>-->
        <div id="ball"><img src="img/balon1.png" style="width: 40px; height: 40px;"></div>
    </div>

    <script>
        // Variables del juego
        let score1 = 0;
        let score2 = 0;
        let timeLeft = 120; // 2 minutos en segundos
        let gameRunning = true;

        const score1El = document.getElementById('score-1');
        const score2El = document.getElementById('score-2');
        const timeEl = document.getElementById('time');
        const playerLeft = document.getElementById('player-left');
        const playerRight = document.getElementById('player-right');
        const ball = document.getElementById('ball');
        const gameContainer = document.getElementById('game-container');
        const goalLeft = document.getElementById('goal-left');
        const goalRight = document.getElementById('goal-right');

        // Posiciones y velocidades
        let playerLeftPos = { x: 150, y: gameContainer.offsetHeight / 2 - 25 };
        let playerRightPos = { x: gameContainer.offsetWidth - 200, y: gameContainer.offsetHeight / 2 - 25 };
        let ballPos = { x: gameContainer.offsetWidth / 2 - 10, y: gameContainer.offsetHeight / 2 - 10 };
        let ballVel = { x: 0, y: 0 };
        const playerSpeed = 5;
        const ballFriction = 0.99;
        const kickStrength = 10;

        // Teclas presionadas
        let keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Función para actualizar el marcador y resetear la pelota
        function updateScore(player) {
            if (player === 1) {
                score1++;
                score1El.textContent = score1;
            } else if (player === 2) {
                score2++;
                score2El.textContent = score2;
            }
            resetBall();
        }

        // Función para actualizar el temporizador
        function updateTimer() {
            if (gameRunning) {
                timeLeft--;
                timeEl.textContent = timeLeft;
                if (timeLeft <= 0) {
                    gameRunning = false;
                    alert("¡Se acabó el tiempo! El marcador final es " + score1 + " - " + score2);
                }
            }
        }

        // Función para resetear la posición de la pelota
        function resetBall() {
            ballPos.x = gameContainer.offsetWidth / 2 - 10;
            ballPos.y = gameContainer.offsetHeight / 2 - 10;
            ballVel.x = 0;
            ballVel.y = 0;
        }

        // Bucle principal del juego
        function gameLoop() {
            if (!gameRunning) return;

            // --- Movimiento del Jugador 1 (W, A, S, D)
            if (keys['w'] && playerLeftPos.y > 0) playerLeftPos.y -= playerSpeed;
            if (keys['s'] && playerLeftPos.y < gameContainer.offsetHeight - playerLeft.offsetHeight) playerLeftPos.y += playerSpeed;
            if (keys['a'] && playerLeftPos.x > 0) playerLeftPos.x -= playerSpeed;
            if (keys['d'] && playerLeftPos.x < gameContainer.offsetWidth / 2 - playerLeft.offsetWidth) playerLeftPos.x += playerSpeed;

            // --- Movimiento del Jugador 2 (Arrow Keys)
            if (keys['ArrowUp'] && playerRightPos.y > 0) playerRightPos.y -= playerSpeed;
            if (keys['ArrowDown'] && playerRightPos.y < gameContainer.offsetHeight - playerRight.offsetHeight) playerRightPos.y += playerSpeed;
            if (keys['ArrowLeft'] && playerRightPos.x > gameContainer.offsetWidth / 2) playerRightPos.x -= playerSpeed;
            if (keys['ArrowRight'] && playerRightPos.x < gameContainer.offsetWidth - playerRight.offsetWidth) playerRightPos.x += playerSpeed;

            // --- Movimiento de la Pelota
            ballPos.x += ballVel.x;
            ballPos.y += ballVel.y;
            ballVel.x *= ballFriction;
            ballVel.y *= ballFriction;

            // Detección de colisiones con los bordes
            if (ballPos.x <= 0 || ballPos.x + ball.offsetWidth >= gameContainer.offsetWidth) {
                ballVel.x = -ballVel.x;
            }
            if (ballPos.y <= 0 || ballPos.y + ball.offsetHeight >= gameContainer.offsetHeight) {
                ballVel.y = -ballVel.y;
            }

            // --- Colisión y Mecánica de Tiro
            
            // Colisión Jugador 1
            const dx1 = ballPos.x - playerLeftPos.x;
            const dy1 = ballPos.y - playerLeftPos.y;
            const distance1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
            if (distance1 < playerLeft.offsetWidth) {
                const angle = Math.atan2(dy1, dx1);
                ballVel.x = Math.cos(angle) * kickStrength;
                ballVel.y = Math.sin(angle) * kickStrength;
            }

            // Colisión Jugador 2
            const dx2 = ballPos.x - playerRightPos.x;
            const dy2 = ballPos.y - playerRightPos.y;
            const distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
            if (distance2 < playerRight.offsetWidth) {
                const angle = Math.atan2(dy2, dx2);
                ballVel.x = Math.cos(angle) * kickStrength;
                ballVel.y = Math.sin(angle) * kickStrength;
            }

            // Detección de Gol
            if (ballPos.x <= goalLeft.offsetWidth && ballPos.y >= goalLeft.offsetTop && ballPos.y <= goalLeft.offsetTop + goalLeft.offsetHeight) {
                updateScore(2);
            }
            if (ballPos.x + ball.offsetWidth >= gameContainer.offsetWidth - goalRight.offsetWidth && ballPos.y >= goalRight.offsetTop && ballPos.y <= goalRight.offsetTop + goalRight.offsetHeight) {
                updateScore(1);
            }

            // Actualizar posiciones en la pantalla
            playerLeft.style.left = playerLeftPos.x + 'px';
            playerLeft.style.top = playerLeftPos.y + 'px';
            playerRight.style.left = playerRightPos.x + 'px';
            playerRight.style.top = playerRightPos.y + 'px';
            ball.style.left = ballPos.x + 'px';
            ball.style.top = ballPos.y + 'px';

            requestAnimationFrame(gameLoop);
        }

        // Iniciar el temporizador
        setInterval(updateTimer, 1000);

        // Iniciar el bucle del juego
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
